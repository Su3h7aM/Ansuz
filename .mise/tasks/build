#!/usr/bin/env bash
#MISE description="Build Ansuz examples"
#MISE alias="b"
#MISE sources=["ansuz/**/*.odin", "examples/**/*.odin"]
#MISE outputs=["bin/hello_world", "bin/complex_demo", "bin/layout_demo", "bin/btop_demo", "bin/features_demo", "bin/crush_demo", "bin/opencode_demo"]

set -euo pipefail

CLEAN=0
for arg in "$@"; do
    case "$arg" in
        -c|--clean)
            CLEAN=1
            ;;
        -h|--help)
            echo "Usage: mise build [-c|--clean]"
            echo ""
            echo "Options:"
            echo "  -c, --clean    Remove existing binaries before building"
            echo "  -h, --help     Show this help message"
            exit 0
            ;;
    esac
done

if ! command -v odin &>/dev/null; then
    if [[ -n "${ODIN_ROOT:-}" ]] && [[ -x "$ODIN_ROOT/odin" ]]; then
        export PATH="$ODIN_ROOT:$PATH"
    else
        echo "Error: 'odin' not found. Set ODIN_ROOT or install Odin." >&2
        exit 1
    fi
fi

if [[ "$CLEAN" == "1" ]]; then
    echo "Cleaning build artifacts..."
    rm -f bin/hello_world bin/complex_demo bin/layout_demo bin/btop_demo bin/features_demo bin/crush_demo bin/opencode_demo
    echo "Clean complete."
fi

mkdir -p bin

echo "Building hello_world..."
odin build examples/hello_world.odin -file -out:bin/hello_world -debug

echo "Building complex_demo..."
odin build examples/complex_demo.odin -file -out:bin/complex_demo -debug

echo "Building layout_demo..."
odin build examples/layout_demo.odin -file -out:bin/layout_demo -debug

echo "Building btop_demo..."
odin build examples/btop_demo.odin -file -out:bin/btop_demo -debug

echo "Building features_demo..."
odin build examples/features_demo.odin -file -out:bin/features_demo -debug

echo "Building features_demo..."
odin build examples/features_demo.odin -file -out:bin/features_demo -debug

echo "Building crush_demo..."
odin build examples/crush_demo.odin -file -out:bin/crush_demo -debug

echo "Building opencode_demo..."
odin build examples/opencode_demo.odin -file -out:bin/opencode_demo -debug

echo "Build complete!"
