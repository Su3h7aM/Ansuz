#!/usr/bin/env bash
#MISE description="Build Ansuz examples"
#MISE alias="b"
#MISE sources=["ansuz/**/*.odin", "examples/**/*.odin"]
#MISE outputs=["examples/hello_world", "examples/complex_demo", "examples/layout_demo", "examples/btop_demo"]

set -euo pipefail

CLEAN=0
for arg in "$@"; do
    case "$arg" in
        -c|--clean)
            CLEAN=1
            ;;
        -h|--help)
            echo "Usage: mise build [-c|--clean]"
            echo ""
            echo "Options:"
            echo "  -c, --clean    Remove existing binaries before building"
            echo "  -h, --help     Show this help message"
            exit 0
            ;;
    esac
done

if ! command -v odin &>/dev/null; then
    if [[ -n "${ODIN_ROOT:-}" ]] && [[ -x "$ODIN_ROOT/odin" ]]; then
        export PATH="$ODIN_ROOT:$PATH"
    else
        echo "Error: 'odin' not found. Set ODIN_ROOT or install Odin." >&2
        exit 1
    fi
fi

if [[ "$CLEAN" == "1" ]]; then
    echo "Cleaning build artifacts..."
    rm -f examples/hello_world examples/complex_demo examples/layout_demo examples/btop_demo
    echo "Clean complete."
fi

echo "Building hello_world..."
odin build examples/hello_world.odin -file -out:examples/hello_world -debug

echo "Building complex_demo..."
odin build examples/complex_demo.odin -file -out:examples/complex_demo -debug

echo "Building layout_demo..."
odin build examples/layout_demo.odin -file -out:examples/layout_demo -debug

echo "Building btop_demo..."
odin build examples/btop_demo.odin -file -out:examples/btop_demo -debug

echo "Build complete!"
