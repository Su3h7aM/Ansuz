#!/usr/bin/env bash
#MISE description="Build Ansuz examples"
#MISE alias="b"
#MISE sources=["ansuz/**/*.odin", "examples/**/*.odin"]
#MISE outputs=["bin/hello_world", "bin/sysmon", "bin/benchmark", "bin/explorer", "bin/color_demo", "bin/wrap_demo"]

set -euo pipefail

CLEAN=0
for arg in "$@"; do
    case "$arg" in
        -c|--clean)
            CLEAN=1
            ;;
        -h|--help)
            echo "Usage: mise build [-c|--clean]"
            echo ""
            echo "Options:"
            echo "  -c, --clean    Remove existing binaries before building"
            echo "  -h, --help     Show this help message"
            exit 0
            ;;
    esac
done

if ! command -v odin &>/dev/null; then
    if [[ -n "${ODIN_ROOT:-}" ]] && [[ -x "$ODIN_ROOT/odin" ]]; then
        export PATH="$ODIN_ROOT:$PATH"
    else
        echo "Error: 'odin' not found. Set ODIN_ROOT or install Odin." >&2
        exit 1
    fi
fi

if [[ "$CLEAN" == "1" ]]; then
    echo "Cleaning build artifacts..."
    rm -rf bin/*
    echo "Clean complete."
fi

mkdir -p bin

echo "Building hello_world..."
odin build examples/hello_world.odin -file -out:bin/hello_world -debug

echo "Building sysmon..."
odin build examples/sysmon.odin -file -out:bin/sysmon -debug

echo "Building benchmark..."
odin build examples/benchmark.odin -file -out:bin/benchmark -debug

echo "Building explorer..."
odin build examples/explorer.odin -file -out:bin/explorer -debug

echo "Building color_demo..."
odin build examples/color_demo.odin -file -out:bin/color_demo -debug

echo "Building wrap_demo..."
odin build examples/wrap_demo.odin -file -out:bin/wrap_demo -debug

echo "Build complete!"
