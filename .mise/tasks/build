#!/usr/bin/env bash
#MISE description="Build Ansuz examples"
#MISE alias="b"
#MISE sources=["ansuz/**/*.odin", "examples/**/*.odin"]
#MISE outputs=["bin/hello_world", "bin/sysmon", "bin/benchmark", "bin/explorer", "bin/color_demo", "bin/wrap_demo", "bin/focus_demo", "bin/widget_demo"]

set -euo pipefail

CLEAN=0
for arg in "$@"; do
    case "$arg" in
        -c|--clean)
            CLEAN=1
            ;;
        -h|--help)
            echo "Usage: mise build [-c|--clean]"
            echo ""
            echo "Options:"
            echo "  -c, --clean    Remove existing binaries before building"
            echo "  -h, --help     Show this help message"
            exit 0
            ;;
    esac
done

if [[ "$CLEAN" == "1" ]]; then
    echo "Cleaning build artifacts..."
    rm -rf bin/*
    echo "Clean complete."
fi

mkdir -p bin

FLAGS="-o:minimal -linker:mold -microarch:native"

echo "Building hello_world..."
odin build examples/hello_world.odin -file -out:bin/hello_world $FLAGS

echo "Building sysmon..."
odin build examples/sysmon.odin -file -out:bin/sysmon $FLAGS

echo "Building benchmark..."
odin build examples/benchmark.odin -file -out:bin/benchmark $FLAGS

echo "Building explorer..."
odin build examples/explorer.odin -file -out:bin/explorer $FLAGS

echo "Building color_demo..."
odin build examples/color_demo.odin -file -out:bin/color_demo $FLAGS

echo "Building wrap_demo..."
odin build examples/wrap_demo.odin -file -out:bin/wrap_demo $FLAGS

echo "Building focus_demo..."
odin build examples/focus_demo.odin -file -out:bin/focus_demo $FLAGS

echo "Building widget_demo..."
odin build examples/widget_demo.odin -file -out:bin/widget_demo $FLAGS

echo "Build complete!"
